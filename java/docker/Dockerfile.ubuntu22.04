FROM ubuntu:22.04

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install basic build tools and dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    ca-certificates \
    wget \
    curl \
    git \
    g++ \
    gcc \
    make \
    ccache \
    gdb \
    clang-format-14 \
    clang-tidy-14 \
    python3 \
    python3-pip \
    default-jdk \
    build-essential \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

# Install CMake 3.27.5
RUN wget -qO- "https://cmake.org/files/v3.27/cmake-3.27.5-linux-$(uname -m).tar.gz" | \
    tar --strip-components=1 -xz -C /usr/local

# Install Conan 1.61.0
RUN pip3 install --no-cache-dir conan==1.61.0

# Set JAVA_HOME for JNI support
ENV JAVA_HOME=/usr/lib/jvm/default-java

# Create working directory
WORKDIR /milvus-storage

# Copy project files
COPY . .

# Set default command
CMD ["/bin/bash"]
